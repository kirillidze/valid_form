<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>VALID_FORM</title>
  <style>
    body {
      height: 1000px;
    }
    input[type="button"] {
      position: absolute;
      bottom: -100px;
    }
    /*стилевые свойтва для указателя сообщения об ошибке */
    .error-message::before {
      content:'';
      position: absolute;
      left: -10px;
      top: 3px;
      width: 0;
      height: 0;
      border-top: 6px solid transparent;
      border-right: 10px solid red;
      border-bottom: 6px solid transparent;
    }
  </style>
</head>
<body>
  <p>Для внесения вашего сайта в каталог, заполните форму: </p>
  <form id="SITE_FORM" action="http://fe.it-academy.by/TestForm.php" name="SITE_INFO">
    <span class="item">Разработчики:</span>
    <input type="text" name="DEVELOPERS" placeholder="ФИО">
    <span class="error-message">Данные некорректны</span><br>
    <span class="item">Название сайта:</span>
    <input type="text" name="SITE_NAME">
    <span class="error-message">Введите название не более 30 символов</span><br>
    <span class="item">URL сайта:</span>
    <input type="url" name="SITE_URL" placeholder="http://...">
    <span class="error-message">Введите сайт в формате http://xxx.xx</span><br>
    <span class="item">Дата запуска сайта:</span>
    <input type="text" name="DATE" placeholder="дд.мм.гггг">
    <span class="error-message">Введите корректную дату в формате дд.мм.гггг</span><br>
    <span class="item">Посетителей в сутки:</span>
    <input type="text" name="VISITORS" placeholder="цифрами">
    <span class="error-message">Введите значение в цифрах</span><br>
    <span class="item">E-mail для связи:</span>
    <input type="email" name="E-MAIL">
    <span class="error-message">Введите корректный e-mail</span><br>
    <span class="item">Рубрика каталога:</span>
    <select name="CATEGORY">
      <option value="0" disabled selected>выберите рубрику</option>
      <option value="1">здоровье</option>
      <option value="2">домашний уют</option>
      <option value="3">бытовая техника</option>
    </select>
    <span class="error-message">Вы не выбрали рубрику</span><br>
    <span class="item">Размещение:</span>
    <input type="radio" id="FREE_LOCATION" name="LOCATION" value="11">
    <label for="FREE_LOCATION">бесплатное</label>
    <input type="radio" id="PAY_LOCATION" name="LOCATION" value="12">
    <label for="PAY_LOCATION">платное </label>
    <input type="radio" id="VIP_LOCATION" name="LOCATION" value="13">
    <label for="VIP_LOCATION">VIP</label>
    <span class="error-message error-message--radio">Выберите один из пунктов</span><br>
    <span class="item">Разрешить отзывы:</span>
    <input type="checkbox" name="COMMENTS">
    <span class="error-message">Вы должны дать согласие на отправку отзывов</span><br>
    <span class="item">Описание сайта:</span><br>
    <textarea name="DESCRIPTION" cols="30" rows="10" placeholder="Введите не менее 30 символов, но не более 300..."></textarea>
    <span class="error-message">Введите, пожалуйста, описание сайта</span><br>
  </form>
  <p>Кнопка отправки формы находится ниже</p>
  <input type="button" value="Опубликовать" form="SITE_FORM">

  <script type="text/javascript">
    'use strict';
      //выравниваем по ширине названия всех пунктов
      let span = document.getElementsByClassName('item');
      for (let i = 0; i < span.length; i++) {
        let elem = span[i];
        elem.style.cssText = 'display: inline-block; width: 150px;';
      }

      //применяем стили размеров для разных форм
      let frm = document.forms['SITE_INFO'];
      frm.elements['DEVELOPERS'].style.cssText = 'width: 320px;';
      frm.elements['SITE_NAME'].style.cssText = 'width: 320px;';
      frm.elements['SITE_URL'].style.cssText = 'width: 200px;';
      frm.elements['DATE'].style.cssText = 'width: 100px;';
      frm.elements['VISITORS'].style.cssText = 'width: 100px;';
      frm.elements['E-MAIL'].style.cssText = 'box-sizing: border-box; width: 140px;';
      frm.elements['CATEGORY'].style.cssText = 'box-sizing: border-box; width: 140px;';
      frm.elements['DESCRIPTION'].style.cssText = 'height: 90px; width: 475px;';

      //применяем стили для сообщений об ошибке
      let errorMessage = document.getElementsByClassName('error-message');
      for (let i = 0; i < errorMessage.length; i++) {
        let elem = errorMessage[i];
        elem.style.cssText = `display: none;
                              position:absolute;
                              margin-left: 10px;
                              padding: 0 5px 0;
                              background: red;
                              opacity: .6;`;
      }

      // подписываем форму на событие focusout
      frm.addEventListener('focusout', validateInfoForm, false);

      //находим кнопку отправки формы и подписываем на неё событие click
      let submitButton = document.querySelector('input[type="button"]');
      submitButton.addEventListener('click', sendingForm, false);

      //находим все нужные элементы формы для валидации при отправке
      let allElements = document.querySelectorAll(`form[name="SITE_INFO"] input,
                                                   form[name="SITE_INFO"] select,
                                                   form[name="SITE_INFO"] textarea`
      );

      //очищаем данные при рефреше страницы
      for (let i = 0; i < allElements.length; i++) {
          let elem = allElements[i];

          switch (elem.name) {
            case 'LOCATION':
            case 'COMMENTS':
              elem.checked = false;
              break;
            default:
              elem.value = '';
              break;
          }
      }

      //сообщение об ошибке для радиобаттонов
      let errorRadio = document.getElementsByClassName('error-message--radio')[0];


      function validateInfoForm(e) {
        let errorItem = e.target.nextElementSibling,
            //выбранный радиобаттон пользователем
              radioChecked = document.querySelector('input[name="LOCATION"]:checked'),
            //выбранный чекбокс
            checkboxChecked = document.querySelector('input[name="COMMENTS"]:checked');

        switch (e.target.name) {
            case 'SITE_NAME':
              if(e.target.value.length > 30 || e.target.value.length < 1) {
                errorItem.style.display = 'inline-block';
              } else {
                errorItem.style.display = 'none';
              }
              break;
            case 'SITE_URL':
              if(e.target.value.match(/http:\/\/\w/) || e.target.value.match(/https:\/\/\w/)) {
                errorItem.style.display = 'none';
              } else {
                errorItem.style.display = 'inline-block';
              }
              break;
            case 'DATE':
              if(e.target.value.match(/(0[1-9]|[1-2]\d|3[0-1])\.(0[1-9]|1[1-2]).(19|20)\d\d/)) {
                errorItem.style.display = 'none';
              } else {
                errorItem.style.display = 'inline-block';
              }
              break;
            case 'DEVELOPERS':
              if(isNaN(e.target.value) && !parseFloat(e.target.value)) {
                errorItem.style.display = 'none';
              } else {
                errorItem.style.display = 'inline-block';
              }
              break;
            case 'VISITORS':
              if(!isNaN(parseFloat(e.target.value)) && isFinite(e.target.value)) {
                  errorItem.style.display = 'none';
                } else {
                  errorItem.style.display = 'inline-block';
                }
              break;
            case 'E-MAIL':
              if(e.target.value.match(/\w@\w/)) {
                errorItem.style.display = 'none';
              } else {
                errorItem.style.display = 'inline-block';
              }
              break;
            case 'CATEGORY':
              if(e.target.value !== '') {
                errorItem.style.display = 'none';
              } else {
                errorItem.style.display = 'inline-block';
              }
              break;
            case 'LOCATION':
              if (radioChecked) {
                errorRadio.style.display = 'none';
              } else {
                errorRadio.style.display = 'inline-block';
              }
              break;
            case 'COMMENTS':
              if (checkboxChecked) {
                  errorItem.style.display = 'none';
                } else {
                  errorItem.style.display = 'inline-block';
                }
              break;
            case 'DESCRIPTION':
              if(e.target.value.length < 300 && e.target.value.length > 30) {
                  errorItem.style.display = 'none';
                } else {
                  errorItem.style.display = 'inline-block';
                }
              break;
            default:
              break;
          }
      }

      //функция валидации и отправки формы
      function sendingForm(e) {
        //перебираем каждый элемент формы
        for (let i = 0; i < allElements.length; i++) {
          let elem = allElements[i],
              errorItem = elem.nextElementSibling,
              //выбранный радиобаттон пользователем
              radioChecked = document.querySelector('input[name="LOCATION"]:checked'),
              //выбранный чекбокс
              checkboxChecked = document.querySelector('input[name="COMMENTS"]:checked');

          switch (elem.type) {
            case 'url':
            case 'email':
            case 'textarea':
            case 'text':
              if(elem.value === '') {
                errorItem.style.display = 'inline-block';
                elem.focus();
              }
              break;
            case 'select-one':
              if(elem.value === '0') {
                  errorItem.style.display = 'inline-block';
                  elem.focus();
                }
              break;
            case 'radio':
              if (!radioChecked) {
                errorRadio.style.display = 'inline-block';
                elem.focus();
              }
              break;
            case 'checkbox':
                if (!checkboxChecked) {
                  errorItem.style.display = 'inline-block';
                  elem.focus();
                }
              break;
            default:
              break;
          }

        }

        let errorMessages = document.querySelectorAll('span.error-message');
        let arrErrorMessages = [...errorMessages];
        //если не показано ни одного сообщения об ошибке - отправляем форму
        let noErrors = arrErrorMessages.every((i)=>i.style.display === 'none');
        if(noErrors) {
          frm.submit();
        }

      }

  </script>

</body>
</html>
